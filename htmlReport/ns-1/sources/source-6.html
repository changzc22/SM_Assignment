


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TrainServiceTest</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">test</a>
</div>

<h1>Coverage Summary for Class: TrainServiceTest (test)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TrainServiceTest</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (11/11)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (71/71)
  </span>
</td>
</tr>
  <tr>
    <td class="name">TrainServiceTest$InMemoryTrainRepository</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (4/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (6/6)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (15/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (77/77)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package test;
&nbsp;
&nbsp;import oopt.assignment.model.*;
&nbsp;import oopt.assignment.service.TrainService;
&nbsp;import oopt.assignment.service.TrainValidator;
&nbsp;import oopt.assignment.util.AppConstants;
&nbsp;import org.junit.jupiter.api.BeforeEach;
&nbsp;import org.junit.jupiter.api.Test;
&nbsp;
&nbsp;import java.time.LocalDate;
&nbsp;import java.time.LocalTime;
&nbsp;import java.util.*;
&nbsp;
&nbsp;import static org.junit.jupiter.api.Assertions.*;
&nbsp;
&nbsp;/**
&nbsp; * Unit tests for {@link TrainService} using an in-memory fake repository.
&nbsp; */
<b class="fc">&nbsp;class TrainServiceTest {</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Simple in-memory repository for unit testing.
&nbsp;     */
<b class="fc">&nbsp;    private static class InMemoryTrainRepository implements TrainInterface {</b>
<b class="fc">&nbsp;        private final List&lt;Train&gt; store = new ArrayList&lt;&gt;();</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public List&lt;Train&gt; loadAll() {
<b class="fc">&nbsp;            return new ArrayList&lt;&gt;(store);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void saveAll(List&lt;Train&gt; trains) {
<b class="fc">&nbsp;            store.clear();</b>
<b class="fc">&nbsp;            store.addAll(trains);</b>
&nbsp;        }
&nbsp;
&nbsp;        public List&lt;Train&gt; internalStore() {
<b class="fc">&nbsp;            return store;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private InMemoryTrainRepository repo;
&nbsp;    private TrainService service;
&nbsp;
&nbsp;    @BeforeEach
&nbsp;    void setUp() {
<b class="fc">&nbsp;        repo = new InMemoryTrainRepository();</b>
<b class="fc">&nbsp;        TrainValidator validator = new TrainValidator();</b>
&nbsp;
&nbsp;        // pre-populate repository with two trains
<b class="fc">&nbsp;        repo.internalStore().add(new Train(</b>
&nbsp;                &quot;T100&quot;, &quot;Penang&quot;,
<b class="fc">&nbsp;                LocalDate.of(2030, 1, 1),</b>
<b class="fc">&nbsp;                LocalTime.of(10, 0),</b>
&nbsp;                100, 20, 50.0, 120.0,
&nbsp;                TrainStatus.ACTIVE
&nbsp;        ));
<b class="fc">&nbsp;        repo.internalStore().add(new Train(</b>
&nbsp;                &quot;T200&quot;, &quot;Johor&quot;,
<b class="fc">&nbsp;                LocalDate.of(2030, 2, 1),</b>
<b class="fc">&nbsp;                LocalTime.of(12, 0),</b>
&nbsp;                80, 10, 45.0, 110.0,
&nbsp;                TrainStatus.DISCONTINUED
&nbsp;        ));
&nbsp;
<b class="fc">&nbsp;        service = new TrainService(repo, validator);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies that getAllTrains returns a defensive copy and not the internal list.
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testGetAllTrainsReturnsCopy() {
<b class="fc">&nbsp;        List&lt;Train&gt; list1 = service.getAllTrains();</b>
<b class="fc">&nbsp;        List&lt;Train&gt; list2 = service.getAllTrains();</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(2, list1.size());</b>
<b class="fc">&nbsp;        assertNotSame(list1, list2);</b>
&nbsp;
<b class="fc">&nbsp;        list1.clear();</b>
<b class="fc">&nbsp;        assertEquals(2, service.getAllTrains().size());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies that active trains are filtered correctly.
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testGetActiveTrains() {
<b class="fc">&nbsp;        List&lt;Train&gt; active = service.getActiveTrains();</b>
<b class="fc">&nbsp;        assertEquals(1, active.size());</b>
<b class="fc">&nbsp;        assertEquals(&quot;T100&quot;, active.get(0).getTrainID());</b>
<b class="fc">&nbsp;        assertEquals(TrainStatus.ACTIVE, active.get(0).getStatus());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies finding trains by ID (found and not found cases).
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testFindById() {
<b class="fc">&nbsp;        Optional&lt;Train&gt; found = service.findById(&quot;T100&quot;);</b>
<b class="fc">&nbsp;        assertTrue(found.isPresent());</b>
<b class="fc">&nbsp;        assertEquals(&quot;Penang&quot;, found.get().getDestination());</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(service.findById(&quot;T999&quot;).isEmpty());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies that addTrain appends to the in-memory list and calls save().
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testAddTrain() {
<b class="fc">&nbsp;        Train newTrain = new Train(</b>
&nbsp;                &quot;T300&quot;, &quot;Melaka&quot;,
<b class="fc">&nbsp;                LocalDate.of(2030, 3, 3),</b>
<b class="fc">&nbsp;                LocalTime.of(15, 0),</b>
&nbsp;                90, 15, 55.0, 130.0,
&nbsp;                TrainStatus.ACTIVE
&nbsp;        );
&nbsp;
<b class="fc">&nbsp;        service.addTrain(newTrain);</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(3, service.getAllTrains().size());</b>
<b class="fc">&nbsp;        assertEquals(3, repo.internalStore().size());</b>
<b class="fc">&nbsp;        assertEquals(&quot;T300&quot;, repo.internalStore().get(2).getTrainID());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies that createTrain builds a Train from TrainCreationRequest
&nbsp;     * and sets status ACTIVE by default.
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testCreateTrain() {
<b class="fc">&nbsp;        TrainCreationRequest req = new TrainCreationRequest();</b>
<b class="fc">&nbsp;        req.trainId = &quot;T400&quot;;</b>
<b class="fc">&nbsp;        req.destination = &quot;Ipoh&quot;;</b>
<b class="fc">&nbsp;        req.departureDate = LocalDate.of(2030, 4, 4);</b>
<b class="fc">&nbsp;        req.departureTime = LocalTime.of(18, 0);</b>
<b class="fc">&nbsp;        req.standardSeatQty = 100;</b>
<b class="fc">&nbsp;        req.premiumSeatQty = 20;</b>
<b class="fc">&nbsp;        req.standardSeatPrice = 60.0;</b>
<b class="fc">&nbsp;        req.premiumSeatPrice = 150.0;</b>
&nbsp;
<b class="fc">&nbsp;        Train created = service.createTrain(req);</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(&quot;T400&quot;, created.getTrainID());</b>
<b class="fc">&nbsp;        assertEquals(&quot;Ipoh&quot;, created.getDestination());</b>
<b class="fc">&nbsp;        assertEquals(TrainStatus.ACTIVE, created.getStatus());</b>
<b class="fc">&nbsp;        assertEquals(3, repo.internalStore().size());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies that discontinueTrain updates the status and triggers save().
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testDiscontinueTrain() {
<b class="fc">&nbsp;        Train t = service.findById(&quot;T100&quot;).orElseThrow();</b>
<b class="fc">&nbsp;        assertEquals(TrainStatus.ACTIVE, t.getStatus());</b>
&nbsp;
<b class="fc">&nbsp;        service.discontinueTrain(t);</b>
&nbsp;
<b class="fc">&nbsp;        assertEquals(TrainStatus.DISCONTINUED, t.getStatus());</b>
&nbsp;        // ensure repository updated
<b class="fc">&nbsp;        assertEquals(TrainStatus.DISCONTINUED,</b>
<b class="fc">&nbsp;                repo.internalStore().stream()</b>
<b class="fc">&nbsp;                        .filter(x -&gt; &quot;T100&quot;.equals(x.getTrainID()))</b>
<b class="fc">&nbsp;                        .findFirst().orElseThrow()</b>
<b class="fc">&nbsp;                        .getStatus());</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies duplicate train ID and destination checks.
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testDuplicateChecks() {
<b class="fc">&nbsp;        assertTrue(service.isDuplicateTrainId(&quot;T100&quot;));</b>
<b class="fc">&nbsp;        assertFalse(service.isDuplicateTrainId(&quot;T999&quot;));</b>
&nbsp;
<b class="fc">&nbsp;        assertTrue(service.isDuplicateDestination(&quot;Penang&quot;));   // active</b>
<b class="fc">&nbsp;        assertFalse(service.isDuplicateDestination(&quot;Johor&quot;));    // discontinued</b>
<b class="fc">&nbsp;        assertFalse(service.isDuplicateDestination(&quot;Unknown&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies that parseDate and parseTime use the shared formatters correctly.
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testParseDateAndTime() {
<b class="fc">&nbsp;        assertEquals(LocalDate.of(2030, 1, 2),</b>
<b class="fc">&nbsp;                service.parseDate(&quot;2030-01-02&quot;));</b>
<b class="fc">&nbsp;        assertEquals(LocalTime.of(9, 15),</b>
<b class="fc">&nbsp;                service.parseTime(&quot;09:15&quot;));</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies that validation delegate methods simply forward to TrainValidator.
&nbsp;     * Here we rely on TrainValidator behaviour already tested in its own unit tests.
&nbsp;     */
&nbsp;    @Test
&nbsp;    void testValidationDelegates() {
&nbsp;        // positive paths should not throw
<b class="fc">&nbsp;        assertTrue(service.isValidTrainIdFormat(&quot;T123&quot;));</b>
<b class="fc">&nbsp;        assertTrue(service.isValidDestinationFormat(&quot;Penang&quot;));</b>
<b class="fc">&nbsp;        assertFalse(service.isValidFutureDate(&quot;2000-01-01&quot;)); // obviously past</b>
<b class="fc">&nbsp;        assertTrue(service.isValidTime(&quot;10:00&quot;));</b>
&nbsp;
&nbsp;        // quantity/price delegates: do not throw for typical valid values
<b class="fc">&nbsp;        assertDoesNotThrow(() -&gt; service.validateStandardSeatQuantity(</b>
&nbsp;                AppConstants.MIN_STANDARD_SEATS + 5,
&nbsp;                AppConstants.MIN_PREMIUM_SEATS));
<b class="fc">&nbsp;        assertDoesNotThrow(() -&gt; service.validatePremiumSeatQuantity(</b>
&nbsp;                AppConstants.MIN_PREMIUM_SEATS + 1,
&nbsp;                AppConstants.MIN_PREMIUM_SEATS + 5));
<b class="fc">&nbsp;        assertDoesNotThrow(() -&gt; service.validateStandardSeatPrice(</b>
&nbsp;                AppConstants.MIN_STANDARD_PRICE + 1.0,
&nbsp;                AppConstants.MIN_PREMIUM_PRICE + 10.0));
<b class="fc">&nbsp;        assertDoesNotThrow(() -&gt; service.validatePremiumSeatPrice(</b>
&nbsp;                AppConstants.MIN_PREMIUM_PRICE + 5.0,
&nbsp;                AppConstants.MIN_PREMIUM_PRICE));
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-12-02 22:30</div>
</div>
</body>
</html>
